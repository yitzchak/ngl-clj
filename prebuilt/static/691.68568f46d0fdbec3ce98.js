"use strict";(self.webpackChunkngl_clj=self.webpackChunkngl_clj||[]).push([[691],{691:(e,t,o)=>{o.r(t),o.d(t,{StageModel:()=>c,StageView:()=>h});var s=o(673),n=o(14),i=(o(204),o(787));const a=o(673),r=o(656);class c extends s.DOMWidgetModel{defaults(){return{...super.defaults(),ambient_color:"#dddddd",ambient_intensity:.2,background_color:"black",camera_eye_sep:.3,camera_fov:40,camera_type:"perspective",clip_dist:10,clip_far:100,clip_mode:"scene",clip_near:0,clip_scale:"relative",components:[],fog_far:100,fog_near:50,fullscreen:!1,hover_timeout:0,impostor:!0,light_color:"#dddddd",light_intensity:1,mouse_preset:"default",pan_speed:1,pick_filter:["click"],quality:"medium",rock:!1,rotate_speed:2,sample_level:0,spin:!1,stage_tooltip:!0,worker_default:!0,zoom_zpeed:1.2,_model_name:"StageModel",_model_module:n.o,_model_module_version:n.Y,_view_name:"StageView",_view_module:n.o,_view_module_version:n.Y}}}function l(e){return(0,i.tB)(e.toObject())}function d(e){return{atom1:l(e.atom1),atom2:l(e.atom2),...(0,i.tB)(e.toObject())}}c.serializers={components:{deserialize:a.unpack_models},...s.DOMWidgetModel.serializers};class h extends s.DOMWidgetView{constructor(){super(...arguments),this.in_components_changing=!1}initialize(e){super.initialize(e),this.componentViews=new i.hW(this.create_ngl_child_view,this.remove_ngl_child_view,this),this.model.on("msg:custom",this.handle_custom_message.bind(this)),this.model.on("change:components",this.components_changed,this),this.model.on("change:fullscreen",(()=>{this.stage_obj&&this.stage_obj.toggleFullscreen()})),this.model.on("change:spin",(e=>{this.stage_obj&&this.stage_obj.setSpin(e.changed.spin)})),this.model.on("change:rock",(e=>{this.stage_obj&&this.stage_obj.setRock(e.changed.rock)})),this.model.on_some_change(["impostor","quality","worker_default","sample_level","background_color","rotate_speed","zoom_zpeed","pan_speed","clip_near","clip_far","clip_dist","clip_mode","clip_scale","fog_near","fog_far","camera_fov","camera_eye_sep","camera_type","light_color","light_intensity","ambient_color","ambient_intensity","hover_timeout","stage_tooltip","mouse_preset"],this.setParameters.bind(this),this),this.on("remove",(()=>{this.send({event:"remove"})}))}async components_changed(){this.in_components_changing=!0;let e=await this.componentViews.update(this.model.get("components"));for(let t of e)await t.render();this.in_components_changing=!1}handle_custom_message(e){if(this.stage_obj)switch(e.do){case"make_image":this.make_image(e);break;case"auto_view":this.stage_obj.autoView(e.duration||0);break;case"move":this.stage_obj.animationControls.move(e.to,e.duration||0)}}async make_image(e){const t=await this.stage_obj.makeImage(e);this.send({event:"image",type:t.type,uuid:e.uuid},[await t.arrayBuffer()])}stage_parameters(){return{impostor:this.model.get("impostor"),quality:this.model.get("quality"),workerDefault:this.model.get("worker_default"),sampleLevel:this.model.get("sample_Level"),backgroundColor:this.model.get("background_color"),rotateSpeed:this.model.get("rotate_speed"),zoomSpeed:this.model.get("zoom_speed"),panSpeed:this.model.get("pan_speed"),clipNear:this.model.get("clip_near"),clipFar:this.model.get("clip_far"),clipDist:this.model.get("clip_dist"),clipMode:this.model.get("clip_mode"),clipScale:this.model.get("clip_scale"),fogNear:this.model.get("fog_near"),fogFar:this.model.get("fog_far"),cameraFov:this.model.get("camera_fov"),cameraEyeSep:this.model.get("camera_eye_sep"),cameraType:this.model.get("camera_type"),lightColor:this.model.get("light_color"),lightIntensity:this.model.get("light_intensity"),ambientColor:this.model.get("ambient_color"),ambientIntensity:this.model.get("ambient_intensity"),hoverTimeout:this.model.get("hover_timeout"),tooltip:this.model.get("stage_tooltip"),mousePreset:this.model.get("mouse_preset")}}render(){super.render(),this.displayed.then((()=>{this.el.classList.add("ngl-stage"),this.el.classList.add("jupyter-widgets"),this.el.setAttribute("data-jp-suppress-context-menu",""),this.stage_container=document.createElement("div"),this.el.appendChild(this.stage_container),this.stage_obj=new r.Stage(this.stage_container,this.stage_parameters()),document.body.appendChild(this.stage_obj.tooltip),this.components_changed(),this.model.get("spin")&&this.stage_obj.setSpin(!0),this.model.get("rock")&&this.stage_obj.setRock(!0),this.stage_obj.signals.fullscreenChanged.add((e=>{this.model.set("fullscreen",e),this.model.save_changes()})),this.stage_obj.signals.clicked.add((e=>this.on_pick("click",e))),this.stage_obj.signals.hovered.add((e=>this.on_pick("hover",e)))}))}on_pick(e,t){if(this.model.get("pick_filter").includes(e)){var o={type:null,signal:e};t&&(o.type=t.type,o.alt_key=t.altKey,o.ctrl_key=t.ctrlKey,o.meta_key=t.metaKey,o.shift_key=t.shiftKey,t.atom&&(o.atom=l(t.atom)),t.bond&&(o.bond=d(t.bond)),t.closestBondAtom&&(o.closest_bond_atom=l(t.closestBondAtom)),t.component&&(o.component=t.component.name),t.contact&&(o.contact=d(t.contact)),t.distance&&(o.distance=d(t.distance)),t.position&&(o.position=(0,i.tB)(t.position))),this.send({event:"pick",data:o})}}setParameters(){this.stage_obj&&this.stage_obj.setParameters(this.stage_parameters())}processLuminoMessage(e){if(super.processLuminoMessage(e),("resize"===e.type||"after-show"===e.type)&&this.stage_obj){const e=this.el.getBoundingClientRect();this.stage_obj.setSize(Math.floor(e.width)+"px",Math.floor(e.height)+"px")}}create_ngl_child_view(e){return this.create_child_view(e,{stage_obj:this.stage_obj})}remove_ngl_child_view(e){e.remove()}}},787:(e,t,o)=>{o.d(t,{AF:()=>l,Z9:()=>i,eT:()=>r,hW:()=>c,tB:()=>a});var s=o(818);const n=o(656);function i(e,t){var o={};for(const[n,i]of Object.entries(t)){const t=e.get(i||(0,s.snake)(n));null!=t&&(o[n]=t)}return o}function a(e){var t={};for(const[o,n]of Object.entries(e))t[(0,s.snake)(o)]=n;return t}function r(e){var t={};for(const[o,n]of Object.entries(e))"_"!==o[0]&&null!==n&&(t[(0,s.camel)(o)]=n);return t}class c{constructor(e,t,o){this._model_views=new Map,this._handler_context=o||this,this._create_view=e,this._remove_view=t||function(e){e.remove()}}async update(e){for(let[t,o]of this._model_views)e.includes(t)||(this._remove_view.call(this._handler_context,o),this._model_views.delete(t));let t=[];for(let o of e)if(!this._model_views.has(o)){let e=await this._create_view.call(this._handler_context,o);t.push(e),this._model_views.set(o,e)}return t}remove(){for(let e of this._model_views.values())this._remove_view.call(this._handler_context,e);this._model_views.clear()}dispose(){this._model_views.clear()}}function l(e){let t=Object.assign({},e);switch(delete t.type,delete t.buffer,e.type){case"arrow":return new n.ArrowBuffer(t);case"box":return new n.BoxBuffer(t);case"cone":return new n.ConeBuffer(t);case"cylinder":return new n.CylinderBuffer(t);case"ellisoid":return new n.EllipsoidBuffer(t);case"mesh":return new n.MeshBuffer(t);case"octahedron":return new n.OctahedronBuffer(t);case"point":return new n.PointBuffer(t);case"sphere":return new n.SphereBuffer(t);case"tetrahedron":return new n.TetrahedronBuffer(t);case"text":return new n.TextBuffer(t);case"torus":return new n.TorusBuffer(t);case"wideline":return new n.WidelineBuffer(t)}}},889:(e,t,o)=>{o.d(t,{Z:()=>r});var s=o(81),n=o.n(s),i=o(645),a=o.n(i)()(n());a.push([e.id,".jupyter-widgets.ngl-stage {\n  height: 480px;\n  width: 100%;\n  position: relative;\n  overflow: hidden;\n  flex: 1 1 auto;\n}\n\n.jupyter-widgets.ngl-stage > div {\n  position: absolute !important;\n  x: 0;\n  y: 0;\n}\n",""]);const r=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var o="",s=void 0!==t[5];return t[4]&&(o+="@supports (".concat(t[4],") {")),t[2]&&(o+="@media ".concat(t[2]," {")),s&&(o+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),o+=e(t),s&&(o+="}"),t[2]&&(o+="}"),t[4]&&(o+="}"),o})).join("")},t.i=function(e,o,s,n,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(s)for(var r=0;r<this.length;r++){var c=this[r][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);s&&a[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),o&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=o):d[2]=o),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},81:e=>{e.exports=function(e){return e[1]}},204:(e,t,o)=>{var s=o(379),n=o.n(s),i=o(795),a=o.n(i),r=o(569),c=o.n(r),l=o(565),d=o.n(l),h=o(216),m=o.n(h),u=o(589),p=o.n(u),_=o(889),g={};g.styleTagTransform=p(),g.setAttributes=d(),g.insert=c().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=m(),n()(_.Z,g),_.Z&&_.Z.locals&&_.Z.locals},379:e=>{var t=[];function o(e){for(var o=-1,s=0;s<t.length;s++)if(t[s].identifier===e){o=s;break}return o}function s(e,s){for(var i={},a=[],r=0;r<e.length;r++){var c=e[r],l=s.base?c[0]+s.base:c[0],d=i[l]||0,h="".concat(l," ").concat(d);i[l]=d+1;var m=o(h),u={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var p=n(u,s);s.byIndex=r,t.splice(r,0,{identifier:h,updater:p,references:1})}a.push(h)}return a}function n(e,t){var o=t.domAPI(t);return o.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;o.update(e=t)}else o.remove()}}e.exports=function(e,n){var i=s(e=e||[],n=n||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var r=o(i[a]);t[r].references--}for(var c=s(e,n),l=0;l<i.length;l++){var d=o(i[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=c}}},569:e=>{var t={};e.exports=function(e,o){var s=function(e){if(void 0===t[e]){var o=document.querySelector(e);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}t[e]=o}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(o)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,o)=>{e.exports=function(e){var t=o.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(o){!function(e,t,o){var s="";o.supports&&(s+="@supports (".concat(o.supports,") {")),o.media&&(s+="@media ".concat(o.media," {"));var n=void 0!==o.layer;n&&(s+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),s+=o.css,n&&(s+="}"),o.media&&(s+="}"),o.supports&&(s+="}");var i=o.sourceMap;i&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,o)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}}]);