"use strict";(self.webpackChunkngl_clj=self.webpackChunkngl_clj||[]).push([[141],{141:(e,t,i)=>{i.r(t),i.d(t,{ComponentModel:()=>l,ComponentView:()=>h,ShapeModel:()=>m,ShapeView:()=>p,StructureModel:()=>d,StructureView:()=>_});var n=i(673),s=i(14),o=i(818),a=i(787);const r=i(673),c=i(656);class l extends n.WidgetModel{defaults(){return{...super.defaults(),auto_view_duration:null,visible:!0,name:null,position:[0,0,0],positions:null,quaternion:[0,0,0,0],scale:1,annotations:[],representations:[],_model_module:s.o,_model_module_version:s.Y,_view_module:s.o,_view_module_version:s.Y}}}l.serializers={annotations:{deserialize:r.unpack_models},representations:{deserialize:r.unpack_models},positions:{deserialize:e=>e instanceof DataView?new Float32Array(e.buffer):e,serialize:e=>e instanceof Float32Array?new DataView(e.buffer):e},...n.WidgetModel.serializers};class h extends n.WidgetView{constructor(){super(...arguments),this.component_obj=null,this.in_annotations_changing=!1,this.in_representations_changing=!1,this.rendered=!1}initialize(e){super.initialize(e),this.stage_obj=this.options.stage_obj,this.annotationViews=new a.hW(this.create_ngl_child_view,this.remove_ngl_child_view,this),this.representationViews=new a.hW(this.create_ngl_child_view,this.remove_ngl_child_view,this),this.model.on("msg:custom",this.handle_custom_message.bind(this)),this.model.on("change:annotations",this.annotations_changed,this),this.model.on("change:representations",this.representations_changed,this),this.model.on("change:visible",this.visible_changed.bind(this)),this.model.on("change:positions",this.positions_changed,this),this.model.on("change:name",(async e=>{this.component_obj&&(await this.component_obj).setName(e.changed.name)})),this.model.on("change:position",(async e=>{if(this.component_obj){let t=await this.component_obj;t.setPosition(e.changed.position),t.updateRepresentations({position:!0})}})),this.model.on("change:scale",(async e=>{this.component_obj&&(await this.component_obj).setScale(e.changed.scale)})),this.model.on("change:quaternion",(async e=>{this.component_obj&&(await this.component_obj).setRotation(e.changed.quaternion)}))}parameter_names(){return["name","visible"]}get_parameters(){var e={};for(const i of this.parameter_names()){var t=this.model.get(i);null!=t&&(e[(0,o.camel)(i)]=t)}return e}async positions_changed(){var e=this.model.get("positions");let t=await this.component_obj;e&&(t.structure.updatePosition(e),t.updateRepresentations({position:!0}))}async representations_changed(){this.in_representations_changing=!0;let e=await this.representationViews.update(this.model.get("representations"));for(let t of e)await t.render();this.in_representations_changing=!1}async annotations_changed(){this.in_annotations_changing=!0;let e=await this.annotationViews.update(this.model.get("annotations"));for(let t of e)await t.render();this.in_annotations_changing=!1}async visible_changed(){this.component_obj&&(await this.component_obj).setVisibility(this.model.get("visible"))}async handle_custom_message(e,t){if(this.component_obj)switch(e.do){case"auto_view":(await this.component_obj).autoView(e.duration||0);break;case"update_position":(await this.component_obj).structure.updatePosition(new Float32Array(t[0].buffer)),(await this.component_obj).updateRepresentations({position:!0});break;case"remove_all_measurements":(await this.component_obj).removeAllMeasurements();break;case"remove_measurement":(await this.component_obj).removeMeasurement(e.atoms);break;case"add_measurement":(await this.component_obj).addMeasurement(e.atoms);break;case"move":this.stage_obj.animationControls.moveComponent(await this.component_obj,e.to,e.duration||0);break;case"rock":this.stage_obj.animationControls.rockComponent(await this.component_obj,e.axis,e.angle,e.end,e.duration||0);break;case"spin":this.stage_obj.animationControls.spinComponent(await this.component_obj,e.axis,e.angle,e.duration||0)}}async wire_component(){this.model.get("positions")&&this.positions_changed();let e=await this.component_obj;e.setPosition(this.model.get("position")),e.setScale(this.model.get("scale")),this.annotations_changed(),this.representations_changed();let t=this.model.get("auto_view_duration");null!==t&&e.autoView(t),e.name!=this.model.get("name")&&(this.model.set("name",e.name),this.model.save_changes()),e.signals.nameChanged.add((e=>{this.model.set("name",e||null),this.model.save_changes()}))}async remove(){super.remove(),this.stage_obj&&this.component_obj&&(this.stage_obj.removeComponent(await this.component_obj),this.component_obj=null)}async create_ngl_child_view(e){return this.create_child_view(e,{stage_obj:this.stage_obj,component_obj:await this.component_obj})}remove_ngl_child_view(e){e.remove()}}class d extends l{defaults(){return{...super.defaults(),ext:null,value:null,sele:"",as_trajectory:!1,trajectories:[],_model_name:"StructureModel",_view_name:"StructureView"}}}d.serializers={trajectories:{deserialize:r.unpack_models},...l.serializers};class _ extends h{initialize(e){super.initialize(e),this.trajectory_views=new a.hW(this.create_ngl_child_view,this.remove_ngl_child_view,this),this.model.on("change:trajectories",this.change_trajectories,this)}parameter_names(){return super.parameter_names().concat(["ext","as_trajectory","sele"])}async change_trajectories(){let e=await this.trajectory_views.update(this.model.get("trajectories"));for(let t of e)await t.render()}async load_file(){var e=this.model.get("value");return this.model.get("ext")&&(e=new Blob([e],{type:"string"==typeof e||e instanceof String?"text/plain":"application/octet-binary"})),this.stage_obj.loadFile(e,this.get_parameters())}async render(){this.stage_obj?this.component_obj||(super.render(),this.component_obj=this.load_file(),this.change_trajectories(),this.wire_component()):this.el.textContent="Add to stage widget to visualize."}async wire_component(){await super.wire_component();var e=await this.component_obj;e.spacefillRepresentation.signals.parametersChanged.add((t=>{if(t.sele&&"@"===t.sele[0]){var i=e.structure.getAtomProxy();this.options.parent.send({event:"select",data:t.sele.substring(1).split(",").map((e=>(i.index=parseInt(e),i.toObject())))})}}))}}class m extends l{defaults(){return{...super.defaults(),primitives:[],_model_name:"ShapeModel",_view_name:"ShapeView"}}}class p extends h{initialize(e){super.initialize(e),this.model.on("change:primitives",this.change_primitives,this)}async change_primitives(){this.component_obj&&(this.stage_obj.removeComponent(this.component_obj),this.component_obj=null),await this.render()}async render(){if(!this.component_obj){super.render();let e=new c.Shape(this.model.get("name"));for(const t of this.model.get("primitives"))if(t.buffer)e.addBuffer((0,a.AF)(t));else switch(t.type){case"arrow":e.addArrow(t.position1,t.position2,t.color,t.radius,t.name);break;case"box":e.addBox(t.position,t.color,t.size,t.height_axis,t.depth_axis,t.name);break;case"cone":e.addCone(t.position1,t.position2,t.color,t.radius,t.name);break;case"cylinder":e.addCylinder(t.position1,t.position2,t.color,t.radius,t.name);break;case"ellipsoid":e.addEllipsoid(t.position,t.color,t.radius,t.major_axis,t.minor_axis,t.name);break;case"mesh":e.addMesh(t.position,t.color,t.index,t.normal,t.name);break;case"octahedron":e.addOctahedron(t.position,t.color,t.size,t.height_axis,t.depth_axis,t.name);break;case"sphere":e.addSphere(t.position,t.color,t.radius,t.name);break;case"tetrahedron":e.addTetrahedron(t.position,t.color,t.size,t.height_axis,t.depth_axis,t.name);break;case"text":e.addText(t.position,t.color,t.size,t.text);break;case"torus":e.addTorus(t.position,t.color,t.radius,t.major_axis,t.minor_axis,t.name)}this.component_obj=this.stage_obj.addComponentFromObject(e,this.get_parameters()),this.wire_component()}}}},787:(e,t,i)=>{i.d(t,{AF:()=>l,Z9:()=>o,eT:()=>r,hW:()=>c,tB:()=>a});var n=i(818);const s=i(656);function o(e,t){var i={};for(const[s,o]of Object.entries(t)){const t=e.get(o||(0,n.snake)(s));null!=t&&(i[s]=t)}return i}function a(e){var t={};for(const[i,s]of Object.entries(e))t[(0,n.snake)(i)]=s;return t}function r(e){var t={};for(const[i,s]of Object.entries(e))"_"!==i[0]&&null!==s&&(t[(0,n.camel)(i)]=s);return t}class c{constructor(e,t,i){this._model_views=new Map,this._handler_context=i||this,this._create_view=e,this._remove_view=t||function(e){e.remove()}}async update(e){for(let[t,i]of this._model_views)e.includes(t)||(this._remove_view.call(this._handler_context,i),this._model_views.delete(t));let t=[];for(let i of e)if(!this._model_views.has(i)){let e=await this._create_view.call(this._handler_context,i);t.push(e),this._model_views.set(i,e)}return t}remove(){for(let e of this._model_views.values())this._remove_view.call(this._handler_context,e);this._model_views.clear()}dispose(){this._model_views.clear()}}function l(e){let t=Object.assign({},e);switch(delete t.type,delete t.buffer,e.type){case"arrow":return new s.ArrowBuffer(t);case"box":return new s.BoxBuffer(t);case"cone":return new s.ConeBuffer(t);case"cylinder":return new s.CylinderBuffer(t);case"ellisoid":return new s.EllipsoidBuffer(t);case"mesh":return new s.MeshBuffer(t);case"octahedron":return new s.OctahedronBuffer(t);case"point":return new s.PointBuffer(t);case"sphere":return new s.SphereBuffer(t);case"tetrahedron":return new s.TetrahedronBuffer(t);case"text":return new s.TextBuffer(t);case"torus":return new s.TorusBuffer(t);case"wideline":return new s.WidelineBuffer(t)}}}}]);