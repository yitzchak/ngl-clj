"use strict";(self.webpackChunkngl_clj=self.webpackChunkngl_clj||[]).push([[188],{188:(e,t,r)=>{r.r(t),r.d(t,{TrajectoryModel:()=>i,TrajectoryView:()=>l});var s=r(673),a=r(14),o=r(787);const n=r(656);class i extends s.WidgetModel{defaults(){return{...super.defaults(),direction:"forward",ext:null,frame:0,count:null,interpolate_step:5,interpolate_type:"",is_running:!1,mode:"loop",name:"",step:1,timeout:50,value:null,start:0,end:null,_model_name:"TrajectoryModel",_model_module:a.o,_model_module_version:a.Y,_view_name:"TrajectoryView",_view_module:a.o,_view_module_version:a.Y}}}class l extends s.WidgetView{constructor(){super(...arguments),this.rendered=!1,this.count_callbacks=[],this.frame_callbacks=[]}initialize(e){super.initialize(e),this.stage_obj=this.options.stage_obj,this.component_obj=this.options.component_obj,this.model.on("msg:custom",this.handle_custom_message.bind(this)),this.model.on("change:is_running",this.change_is_running.bind(this)),this.model.on("change:frame",this.change_frame.bind(this)),this.model.on_some_change(["step","timeout","interpolate_type","interpolate_step","start","end","mode","direction"],this.update_player_parameters,this)}change_is_running(e){this.trajectory_obj&&(e.changed.is_running?this.trajectory_obj.trajectory.player.isRunning||this.trajectory_obj.trajectory.player.play():this.trajectory_obj.trajectory.player.isRunning&&this.trajectory_obj.trajectory.player.pause())}change_frame(e){this.trajectory_obj&&this.trajectory_obj.trajectory.frame!==e.changed.frame&&this.trajectory_obj.trajectory.setFrame(e.changed.frame)}update_player_parameters(){if(this.trajectory_obj){const e=(0,o.Z9)(this.model,{step:null,timeout:null,interpolateType:null,interpolateStep:null,mode:null,start:null,end:null,direction:null});this.trajectory_obj.trajectory.player.setParameters(e)}}handle_custom_message(e,t){var r;if(this.trajectory_obj)switch(e.do){case"play":this.trajectory_obj.trajectory.player.play();break;case"pause":this.trajectory_obj.trajectory.player.pause();break;case"stop":this.trajectory_obj.trajectory.player.stop();break;case"count":(r=this.count_callbacks.pop())&&r(e.count);break;case"frame":(r=this.frame_callbacks.pop())&&r(e.i,e.box,new Float32Array(t[0].buffer),e.count)}}get_parameters(){return(0,o.Z9)(this.model,{name:null})}wire_view(){this.update_player_parameters(),this.trajectory_obj.name!=this.model.get("name")&&(this.model.set("name",this.trajectory_obj.name),this.model.save_changes()),this.trajectory_obj.signals.nameChanged.add((e=>{this.model.set("name",e),this.model.save_changes()})),this.trajectory_obj.signals.frameChanged.add((e=>{if(e!=this.model.get("frame")){this.model.set("frame",e);let t=Date.now();(!this.model.get("is_running")||!this.frame_set_time||t-this.frame_set_time>=1e3)&&(this.frame_set_time=t,this.model.save_changes())}})),this.trajectory_obj.signals.countChanged.add((e=>{this.model.set("count",e),this.model.save_changes()})),this.trajectory_obj.trajectory.player.signals.startedRunning.add((()=>{this.model.set("is_running",!0),this.model.save_changes()})),this.trajectory_obj.trajectory.player.signals.haltedRunning.add((()=>{this.model.set("is_running",!1),this.model.save_changes()}))}async load_file(){var e=this.model.get("value"),t=this.model.get("ext");let r={};e&&t&&(r.ext=t,e=new Blob([e instanceof DataView?e.buffer:e],{type:"string"==typeof e||e instanceof String?"text/plain":"application/octet-binary"})),null===e?this.trajectory_obj=await this.component_obj.addTrajectory("",this.get_parameters()):"string"==typeof e&&e.startsWith("jupyter:")?this.trajectory_obj=await this.component_obj.addTrajectory(this.request.bind(this),this.get_parameters()):this.trajectory_obj=await this.component_obj.addTrajectory(await n.autoLoad(e,r),this.get_parameters())}request(e,t,r){"number"==typeof t?(this.frame_callbacks.push(e),this.send({event:"frame",i:t,atom_indices:r},[])):(this.count_callbacks.push(e),this.send({event:"count"},[]))}async render(){super.render(),!this.component_obj||this.trajectory_obj||this.rendered||(this.rendered=!0,await this.load_file(),this.wire_view())}remove(){super.remove(),this.component_obj&&this.trajectory_obj&&this.component_obj.removeTrajectory(this.trajectory_obj),this.trajectory_obj=null}}},787:(e,t,r)=>{r.d(t,{AF:()=>c,Z9:()=>o,eT:()=>i,hW:()=>l,tB:()=>n});var s=r(818);const a=r(656);function o(e,t){var r={};for(const[a,o]of Object.entries(t)){const t=e.get(o||(0,s.snake)(a));null!=t&&(r[a]=t)}return r}function n(e){var t={};for(const[r,a]of Object.entries(e))t[(0,s.snake)(r)]=a;return t}function i(e){var t={};for(const[r,a]of Object.entries(e))"_"!==r[0]&&null!==a&&(t[(0,s.camel)(r)]=a);return t}class l{constructor(e,t,r){this._model_views=new Map,this._handler_context=r||this,this._create_view=e,this._remove_view=t||function(e){e.remove()}}async update(e){for(let[t,r]of this._model_views)e.includes(t)||(this._remove_view.call(this._handler_context,r),this._model_views.delete(t));let t=[];for(let r of e)if(!this._model_views.has(r)){let e=await this._create_view.call(this._handler_context,r);t.push(e),this._model_views.set(r,e)}return t}remove(){for(let e of this._model_views.values())this._remove_view.call(this._handler_context,e);this._model_views.clear()}dispose(){this._model_views.clear()}}function c(e){let t=Object.assign({},e);switch(delete t.type,delete t.buffer,e.type){case"arrow":return new a.ArrowBuffer(t);case"box":return new a.BoxBuffer(t);case"cone":return new a.ConeBuffer(t);case"cylinder":return new a.CylinderBuffer(t);case"ellisoid":return new a.EllipsoidBuffer(t);case"mesh":return new a.MeshBuffer(t);case"octahedron":return new a.OctahedronBuffer(t);case"point":return new a.PointBuffer(t);case"sphere":return new a.SphereBuffer(t);case"tetrahedron":return new a.TetrahedronBuffer(t);case"text":return new a.TextBuffer(t);case"torus":return new a.TorusBuffer(t);case"wideline":return new a.WidelineBuffer(t)}}}}]);