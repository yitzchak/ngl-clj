"use strict";(self.webpackChunkngl_clj=self.webpackChunkngl_clj||[]).push([[691],{691:(e,t,i)=>{i.r(t),i.d(t,{StageModel:()=>l,StageView:()=>h});var o=i(647),n=i(14),s=(i(204),i(787));const a=i(647),r=i(187);class l extends o.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{ambient_color:"#dddddd",ambient_intensity:.2,background_color:"black",camera_eye_sep:.3,camera_fov:40,camera_type:"perspective",clip_dist:10,clip_far:100,clip_mode:"scene",clip_near:0,clip_scale:"relative",components:[],fog_far:100,fog_near:50,fullscreen:!1,hover_timeout:0,impostor:!0,light_color:"#dddddd",light_intensity:1,mouse_preset:"default",pan_speed:1,pick_filter:["click"],quality:"medium",rock:!1,rotate_speed:2,sample_level:0,spin:!1,stage_tooltip:!0,worker_default:!0,zoom_zpeed:1.2,_model_name:"StageModel",_model_module:n.o,_model_module_version:n.Y,_view_name:"StageView",_view_module:n.o,_view_module_version:n.Y})}}function c(e){return(0,s.tB)(e.toObject())}function d(e){return Object.assign({atom1:c(e.atom1),atom2:c(e.atom2)},(0,s.tB)(e.toObject()))}l.serializers=Object.assign({components:{deserialize:a.unpack_models}},o.DOMWidgetModel.serializers);class h extends o.DOMWidgetView{constructor(){super(...arguments),this.in_components_changing=!1}initialize(e){super.initialize(e),this.componentViews=new s.hW(this.create_ngl_child_view,this.remove_ngl_child_view,this),this.model.on("msg:custom",this.handle_custom_message.bind(this)),this.model.on("change:components",this.components_changed,this),this.model.on("change:fullscreen",(()=>{this.stage_obj&&this.stage_obj.toggleFullscreen()})),this.model.on("change:spin",(e=>{this.stage_obj&&this.stage_obj.setSpin(e.changed.spin)})),this.model.on("change:rock",(e=>{this.stage_obj&&this.stage_obj.setRock(e.changed.rock)})),this.model.on_some_change(["impostor","quality","worker_default","sample_level","background_color","rotate_speed","zoom_zpeed","pan_speed","clip_near","clip_far","clip_dist","clip_mode","clip_scale","fog_near","fog_far","camera_fov","camera_eye_sep","camera_type","light_color","light_intensity","ambient_color","ambient_intensity","hover_timeout","stage_tooltip","mouse_preset"],this.setParameters.bind(this),this),this.on("remove",(()=>{this.send({event:"remove"})}))}async components_changed(){this.in_components_changing=!0;let e=await this.componentViews.update(this.model.get("components"));for(let t of e)await t.render();this.in_components_changing=!1}handle_custom_message(e){if(this.stage_obj)switch(e.do){case"make_image":this.make_image(e);break;case"auto_view":this.stage_obj.autoView(e.duration||0);break;case"move":this.stage_obj.animationControls.move(e.to,e.duration||0)}}async make_image(e){const t=await this.stage_obj.makeImage(e);this.send({event:"image",type:t.type,uuid:e.uuid},[await t.arrayBuffer()])}stage_parameters(){return{impostor:this.model.get("impostor"),quality:this.model.get("quality"),workerDefault:this.model.get("worker_default"),sampleLevel:this.model.get("sample_Level"),backgroundColor:this.model.get("background_color"),rotateSpeed:this.model.get("rotate_speed"),zoomSpeed:this.model.get("zoom_speed"),panSpeed:this.model.get("pan_speed"),clipNear:this.model.get("clip_near"),clipFar:this.model.get("clip_far"),clipDist:this.model.get("clip_dist"),clipMode:this.model.get("clip_mode"),clipScale:this.model.get("clip_scale"),fogNear:this.model.get("fog_near"),fogFar:this.model.get("fog_far"),cameraFov:this.model.get("camera_fov"),cameraEyeSep:this.model.get("camera_eye_sep"),cameraType:this.model.get("camera_type"),lightColor:this.model.get("light_color"),lightIntensity:this.model.get("light_intensity"),ambientColor:this.model.get("ambient_color"),ambientIntensity:this.model.get("ambient_intensity"),hoverTimeout:this.model.get("hover_timeout"),tooltip:this.model.get("stage_tooltip"),mousePreset:this.model.get("mouse_preset")}}render(){super.render(),this.displayed.then((()=>{this.el.classList.add("ngl-stage"),this.el.classList.add("jupyter-widgets"),this.el.setAttribute("data-jp-suppress-context-menu",""),this.stage_container=document.createElement("div"),this.el.appendChild(this.stage_container),this.stage_obj=new r.Stage(this.stage_container,this.stage_parameters()),document.body.appendChild(this.stage_obj.tooltip),this.components_changed(),this.model.get("spin")&&this.stage_obj.setSpin(!0),this.model.get("rock")&&this.stage_obj.setRock(!0),this.stage_obj.signals.fullscreenChanged.add((e=>{this.model.set("fullscreen",e),this.model.save_changes()})),this.stage_obj.signals.clicked.add((e=>this.on_pick("click",e))),this.stage_obj.signals.hovered.add((e=>this.on_pick("hover",e)))}))}on_pick(e,t){if(this.model.get("pick_filter").includes(e)){var i={type:null,signal:e};t&&(i.type=t.type,i.alt_key=t.altKey,i.ctrl_key=t.ctrlKey,i.meta_key=t.metaKey,i.shift_key=t.shiftKey,t.atom&&(i.atom=c(t.atom)),t.bond&&(i.bond=d(t.bond)),t.closestBondAtom&&(i.closest_bond_atom=c(t.closestBondAtom)),t.component&&(i.component=t.component.name),t.contact&&(i.contact=d(t.contact)),t.distance&&(i.distance=d(t.distance)),t.position&&(i.position=(0,s.tB)(t.position))),this.send({event:"pick",data:i})}}setParameters(){this.stage_obj&&this.stage_obj.setParameters(this.stage_parameters())}processLuminoMessage(e){if(super.processLuminoMessage(e),("resize"===e.type||"after-show"===e.type)&&this.stage_obj){const e=this.el.getBoundingClientRect();this.stage_obj.setSize(Math.floor(e.width)+"px",Math.floor(e.height)+"px")}}create_ngl_child_view(e){return this.create_child_view(e,{stage_obj:this.stage_obj})}remove_ngl_child_view(e){e.remove()}}},787:(e,t,i)=>{i.d(t,{AF:()=>c,Z9:()=>s,eT:()=>r,hW:()=>l,tB:()=>a});var o=i(818);const n=i(187);function s(e,t){var i={};for(const[n,s]of Object.entries(t)){const t=e.get(s||(0,o.snake)(n));null!=t&&(i[n]=t)}return i}function a(e){var t={};for(const[i,n]of Object.entries(e))t[(0,o.snake)(i)]=n;return t}function r(e){var t={};for(const[i,n]of Object.entries(e))"_"!==i[0]&&null!==n&&(t[(0,o.camel)(i)]=n);return t}class l{constructor(e,t,i){this._model_views=new Map,this._handler_context=i||this,this._create_view=e,this._remove_view=t||function(e){e.remove()}}async update(e){for(let[t,i]of this._model_views)e.includes(t)||(this._remove_view.call(this._handler_context,i),this._model_views.delete(t));let t=[];for(let i of e)if(!this._model_views.has(i)){let e=await this._create_view.call(this._handler_context,i);t.push(e),this._model_views.set(i,e)}return t}remove(){for(let e of this._model_views.values())this._remove_view.call(this._handler_context,e);this._model_views.clear()}dispose(){this._model_views.clear()}}function c(e){let t=Object.assign({},e);switch(delete t.type,delete t.buffer,e.type){case"arrow":return new n.ArrowBuffer(t);case"box":return new n.BoxBuffer(t);case"cone":return new n.ConeBuffer(t);case"cylinder":return new n.CylinderBuffer(t);case"ellisoid":return new n.EllipsoidBuffer(t);case"mesh":return new n.MeshBuffer(t);case"octahedron":return new n.OctahedronBuffer(t);case"point":return new n.PointBuffer(t);case"sphere":return new n.SphereBuffer(t);case"tetrahedron":return new n.TetrahedronBuffer(t);case"text":return new n.TextBuffer(t);case"torus":return new n.TorusBuffer(t);case"wideline":return new n.WidelineBuffer(t)}}},889:(e,t,i)=>{i.d(t,{Z:()=>s});var o=i(645),n=i.n(o)()((function(e){return e[1]}));n.push([e.id,".jupyter-widgets.ngl-stage {\n  height: 480px;\n  width: 100%;\n  position: relative;\n  overflow: hidden;\n  flex: 1 1 auto;\n}\n\n.jupyter-widgets.ngl-stage > div {\n  position: absolute !important;\n  x: 0;\n  y: 0;\n}\n",""]);const s=n},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=e(t);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,o){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(o)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(n[a]=!0)}for(var r=0;r<e.length;r++){var l=[].concat(e[r]);o&&n[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},204:(e,t,i)=>{var o=i(379),n=i.n(o),s=i(889);n()(s.Z,{insert:"head",singleton:!1}),s.Z.locals},379:(e,t,i)=>{var o,n=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),s=[];function a(e){for(var t=-1,i=0;i<s.length;i++)if(s[i].identifier===e){t=i;break}return t}function r(e,t){for(var i={},o=[],n=0;n<e.length;n++){var r=e[n],l=t.base?r[0]+t.base:r[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var h=a(d),m={css:r[1],media:r[2],sourceMap:r[3]};-1!==h?(s[h].references++,s[h].updater(m)):s.push({identifier:d,updater:p(m,t),references:1}),o.push(d)}return o}function l(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var s=i.nc;s&&(o.nonce=s)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var a=n(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function h(e,t,i,o){var n=i?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,n);else{var s=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}function m(e,t,i){var o=i.css,n=i.media,s=i.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var _=null,u=0;function p(e,t){var i,o,n;if(t.singleton){var s=u++;i=_||(_=l(t)),o=h.bind(null,i,s,!1),n=h.bind(null,i,s,!0)}else i=l(t),o=m.bind(null,i,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var i=r(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<i.length;o++){var n=a(i[o]);s[n].references--}for(var l=r(e,t),c=0;c<i.length;c++){var d=a(i[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}i=l}}}}}]);